<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HealthSim Dashboard Profissional</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:#f5f6fa;color:#333;}
nav{background:#fff;padding:18px 40px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,.05);}
.logo{font-weight:700;font-size:20px;color:#0F4C75;}
.nav-right{display:flex;align-items:center;gap:15px;}
.logout{background:#0F4C75;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:600;}
.container{max-width:1200px;margin:auto;padding:40px 20px;}
.welcome{margin-bottom:30px;}
.welcome h1{font-size:28px;margin-bottom:5px;}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:40px;}
.stat{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.05);}
.stat h3{font-size:14px;color:#666;margin-bottom:6px;}
.stat p{font-size:20px;font-weight:700;}
.sim-card{background:#fff;padding:25px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.05);margin-bottom:30px;}
input{width:100%;padding:12px;border-radius:6px;border:1px solid #ccc;margin-top:10px;}
.primary-btn{background:#0F4C75;color:white;border:none;padding:12px;border-radius:6px;cursor:pointer;margin-top:15px;width:100%;font-weight:600;}
.history-item{background:#fff;padding:25px;border-radius:15px;box-shadow:0 6px 18px rgba(0,0,0,.08);margin-bottom:25px;transition:transform .2s;}
.history-item:hover{transform:translateY(-3px);}
.client-name{font-weight:600;font-size:16px;margin-bottom:12px;color:#0F4C75;}
.disease-list{display:flex;flex-wrap:wrap;gap:12px;}
.disease-item{background:#f1f3f5;padding:10px 14px;border-radius:10px;display:flex;align-items:center;justify-content:space-between;font-size:14px;box-shadow:0 2px 5px rgba(0,0,0,.05);}
.disease-item button{background:transparent;border:none;color:#b00000;cursor:pointer;font-size:18px;}
.disease-item button::before{content:"üóëÔ∏è";}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);justify-content:center;align-items:center;z-index:1000;}
.modal-content{background:#fff;padding:35px;border-radius:12px;width:90%;max-width:400px;box-shadow:0 15px 40px rgba(0,0,0,.15);animation:fadeIn .2s ease;}
.modal-content input{margin-bottom:12px;}
.modal-content button{width:100%;padding:12px;border:none;border-radius:6px;cursor:pointer;margin-top:8px;font-weight:600;}
.close-btn{background:#ccc;color:#333;}
@keyframes fadeIn{from{transform:scale(.95);opacity:0;}to{transform:scale(1);opacity:1;}}
@media(max-width:900px){.disease-list{flex-direction:column;}}
</style>
</head>
<body>

<script>
const currentUser=JSON.parse(localStorage.getItem("currentUser"));
if(!currentUser){ window.location.href="login.html"; }
</script>

<nav>
  <div class="logo">HealthSim Platform</div>
  <div class="nav-right">
    <span id="userName" style="cursor:pointer;font-weight:600;" onclick="abrirPerfil()"></span>
    <button class="logout" onclick="logout()">Logout</button>
  </div>
</nav>

<div class="container">
  <div class="welcome">
    <h1>Bem-vindo, <span id="welcomeName"></span></h1>
    <p>Plataforma de simula√ß√£o epidemiol√≥gica</p>
  </div>

  <div class="stats">
    <div class="stat">
      <h3>Total Simula√ß√µes</h3>
      <p id="totalSim">0</p>
    </div>
    <div class="stat">
      <h3>√öltima Simula√ß√£o</h3>
      <p id="ultimaSim">-</p>
    </div>
  </div>

  <div class="sim-card">
    <h2>Simular Doen√ßa</h2>
    <input id="diseaseInput" placeholder="Nome da doen√ßa">
    <button class="primary-btn" onclick="criarSimulacao()">Simular</button>
  </div>

  <h2>Hist√≥rico / Clientes Infetados</h2>
  <div id="historico"></div>
</div>

<!-- MODAL PERFIL -->
<div id="perfilModal" class="modal">
  <div class="modal-content">
    <h2>Editar Perfil</h2>
    <input id="editName" placeholder="Nome">
    <input id="editEmail" placeholder="Email">
    <input id="editPassword" type="password" placeholder="Nova Password (opcional)">
    <button onclick="guardarPerfil()">Guardar Altera√ß√µes</button>
    <button onclick="fecharPerfil()" class="close-btn">Cancelar</button>
    <div id="perfilMsg" style="margin-top:10px;font-size:14px;"></div>
  </div>
</div>

<script>
userName.innerText=currentUser.name+" ("+currentUser.type+")";
welcomeName.innerText=currentUser.name;

function logout(){
  localStorage.removeItem("currentUser");
  window.location.href="login.html";
}

// CRIAR SIMULA√á√ÉO
function criarSimulacao(){
  const disease=diseaseInput.value.trim();
  if(!disease) return;
  const simulacao={id:Date.now(),name:currentUser.name,email:currentUser.email,disease:disease,infected:Math.random()>0.5,date:new Date().toLocaleString()};
  let sims=JSON.parse(localStorage.getItem("simulacoes"))||[];
  sims.push(simulacao);
  localStorage.setItem("simulacoes",JSON.stringify(sims));
  carregarHistorico();
  diseaseInput.value="";
}

// CARREGAR HIST√ìRICO
function carregarHistorico(){
  const sims=JSON.parse(localStorage.getItem("simulacoes"))||[];
  historico.innerHTML="";
  
  if(currentUser.type==="gestor"){
    for(let key in localStorage){
      try{
        const user=JSON.parse(localStorage.getItem(key));
        if(user && user.type==="cliente"){
          const userSims = sims.filter(s=>s.email===user.email && s.infected);
          if(userSims.length===0) continue;

          const card=document.createElement("div");
          card.className="history-item";

          const header=document.createElement("div");
          header.innerHTML=`<strong>${user.name}</strong><br><small>${user.email} | ${user.type}</small>`;
          card.appendChild(header);

          const diseaseList=document.createElement("div");
          diseaseList.className="disease-list";

          userSims.forEach(s=>{
            const diseaseItem=document.createElement("div");
            diseaseItem.className="disease-item";
            diseaseItem.innerHTML=`${s.disease} (${s.date})`;
            const delBtn=document.createElement("button");
            delBtn.onclick=()=>eliminarSimulacao(s.id);
            diseaseItem.appendChild(delBtn);
            diseaseList.appendChild(diseaseItem);
          });

          card.appendChild(diseaseList);
          historico.appendChild(card);
        }
      } catch(e){}
    }
  } else {
    const userSims=sims.filter(s => s.email===currentUser.email);
    const card=document.createElement("div");
    card.className="history-item";
    const nameDiv=document.createElement("div");
    nameDiv.className="client-name";
    nameDiv.innerText=currentUser.name;
    card.appendChild(nameDiv);

    const diseaseList=document.createElement("div");
    diseaseList.className="disease-list";
    userSims.forEach(s=>{
      const diseaseItem=document.createElement("div");
      diseaseItem.className="disease-item";
      diseaseItem.innerText=`${s.disease} (${s.date}) - ${s.infected?"INFETADO":"SAUD√ÅVEL"}`;
      diseaseList.appendChild(diseaseItem);
    });
    card.appendChild(diseaseList);
    historico.appendChild(card);
  }

  const total=sims.filter(s => s.email===currentUser.email || currentUser.type==="gestor").length;
  totalSim.innerText=total;
  ultimaSim.innerText=total ? sims[sims.length-1].date : "-";
}

// ELIMINAR SIMULA√á√ÉO
function eliminarSimulacao(simId){
  let sims=JSON.parse(localStorage.getItem("simulacoes"))||[];
  sims=sims.filter(s=>s.id!==simId);
  localStorage.setItem("simulacoes",JSON.stringify(sims));
  carregarHistorico();
}

// PERFIL MODAL
function abrirPerfil(){
  editName.value=currentUser.name;
  editEmail.value=currentUser.email;
  editPassword.value="";
  perfilModal.style.display="flex";
}
function fecharPerfil(){
  perfilModal.style.display="none";
  perfilMsg.innerHTML="";
}
function guardarPerfil(){
  const novoNome=editName.value.trim();
  const novoEmail=editEmail.value.trim();
  const novaPass=editPassword.value.trim();
  if(!novoNome || !novoEmail){perfilMsg.innerHTML="<span style='color:red'>Nome e Email obrigat√≥rios</span>";return;}
  if(novoEmail !== currentUser.email && localStorage.getItem(novoEmail)){perfilMsg.innerHTML="<span style='color:red'>Email j√° registado</span>";return;}
  let userAtualizado={...currentUser,name:novoNome,email:novoEmail,pass:novaPass?novaPass:currentUser.pass};
  localStorage.removeItem(currentUser.email);
  localStorage.setItem(novoEmail,JSON.stringify(userAtualizado));
  localStorage.setItem("currentUser",JSON.stringify(userAtualizado));
  currentUser.name=novoNome;
  currentUser.email=novoEmail;
  userName.innerText=currentUser.name+" ("+currentUser.type+")";
  welcomeName.innerText=currentUser.name;
  perfilMsg.innerHTML="<span style='color:green'>Perfil atualizado!</span>";
  setTimeout(()=>{fecharPerfil();},1200);
}

carregarHistorico();
</script>

</body>
</html>